name: test-action
on: [pull_request, workflow_dispatch]

jobs:
  test-default:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Setup func CLI
        uses: ./
      - run: func version

  test-custom-version:
    runs-on: ubuntu-latest
    env:
      TEST_VERSION: '1.19.0'
      VERSION_OFFSET: 27  # internal version = minor + offset (v1.19 â†’ v0.46)
    steps:
      - uses: actions/checkout@v4
      - name: Setup func CLI with custom version
        uses: ./
        with:
          version: 'v${{ env.TEST_VERSION }}'
      - name: Verify version
        run: |
          MINOR=$(echo "$TEST_VERSION" | cut -d. -f2)
          INTERNAL=$((MINOR + VERSION_OFFSET))
          func version | grep -q "v0.${INTERNAL}"

  test-custom-name:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Setup func CLI with custom name
        uses: ./
        with:
          name: 'my-func'
      - run: my-func version

  test-windows:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      - name: Setup func CLI
        uses: ./
      - run: func version

  test-macos:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
      - name: Setup func CLI
        uses: ./
      - run: func version
